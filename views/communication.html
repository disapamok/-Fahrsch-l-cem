<!DOCTYPE html>
<html lang="{{sch_getLangHtmlShortCode()}}">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{sch_translate('app_desc')}}">
    <meta name="author" content="{{sch_translate('app_author')}}">
	@include("schleier/topscript")
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url('') }}uploads/app/{{ env('APP_ICON'); }}">
    <title>{{sch_translate('communication_center')}} | {{sch_translate('app_name_long')}}</title>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.4.2/css/buttons.dataTables.min.css" />
    <!-- Material design icons -->
    <link href="{{ url('') }}assets/fonts/mdi/css/materialdesignicons.min.css" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="{{ url('') }}assets/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Simcify CSS -->
    <link href="{{ url('') }}assets/css/simcify.min.css" rel="stylesheet">

    <!-- Landa CSS -->
    <link href="{{ url('') }}assets/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- sidebar -->
    @include("includes/sidebar")
    <!-- header -->
    @include("includes/header")
    <!-- main content -->
    <div class="main-content">
        <div class="page-header">
            <button type="button" class="btn btn-red pull-right ml-5 px-3"  data-toggle="modal" data-target="#sendemail"><i class="fas fa-envelope-open-text mr-2"></i>{{sch_translate('send_email')}} </button>
            <button type="button" class="btn btn-grey pull-right px-3"  data-toggle="modal" data-target="#sendsms"><img src="{{ url('') }}assets/images/icons/paper-plane.svg" class="img-icon mr-2"> {{sch_translate('send_sms')}} </button>
            <h3>{{sch_translate('communication')}}</h3>
        </div>

        <!-- page content -->
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body p-0">
                        <ul class="nav nav-tabs">
                          <li><a href="{{ url('Communication@get') }}" @if (!isset($_GET['view']))  class="active" @endif>
                          {{sch_translate('to_users')}}</a></li>
                          <li><a href="{{ url('Communication@get')}}?view=branches" @if (isset($_GET['view']) && $_GET['view'] == "branches")  class="active" @endif>
                          {{sch_translate('to_branches')}}</a></li>
                          @if($user->role == 'superadmin')
                          <li><a href="{{ url('Communication@get') }}?view=schools" @if (isset($_GET['view']) && $_GET['view'] == "schools")  class="active" @endif>
                          {{sch_translate('to_schools')}}</a></li>
                          @endif
                        </ul>
                        <div class="table-responsive">
                            <table class="table table-striped table-left mb-0 mw-1000" id="data-table">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>{{sch_translate('reciever')}}</th>
                                    <th>{{sch_translate('status')}} + {{sch_translate('date')}} </th>
                                    <th>{{sch_translate('message')}}</th>
                                    <th class="text-center">{{sch_translate('action')}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                @if(!empty($messages))
                                    @foreach($messages as $key => $message)
                                        <tr>
                                            <th scope="row">{{ $key + 1 }}</th>
                                            <td>
                                                @if (!isset($_GET['view'])) 
                                                    @if( !empty($message->avatar) )
                                                    <img src="{{ url('') }}uploads/avatar/{{ $message->avatar }}" class="table-avatar communication-avatar">
                                                    @else
                                                    <img src="{{ url('') }}assets/images/avatar.png" class="table-avatar communication-avatar">
                                                    @endif
                                                    <a href="{{ url('Profile@get',['userid'=>$message->receiver]) }}"><strong class="text-primary">{{ $message->fname }} {{ $message->lname }}</strong></a>
                                                @else
                                                    <strong class="text-primary">{{ $message->name }}</strong>
                                                @endif
                                                <span class="communication-contact">{{ $message->contact }}</span></td>
                                            <td>
                                                {{ date('F j, Y', strtotime($message->sent_at)) }}
                                                <br>
                                                @if ($message->status == "Sent")
                                                    <span class="badge badge-success">{{sch_translate('sent')}}</span>
                                                @else
                                                    <span class="badge badge-danger">{{sch_translate('failed')}}</span>
                                                @endif
                                                @if ($message->type == "sms")
                                                    <span class="badge badge-primary">{{sch_translate('sms')}}</span>
                                                @else
                                                    <span class="badge badge-secondary">{{sch_translate('email')}}</span>
                                                @endif
                                            </td>
                                            <td>
                                                @if ( strlen($message->message) > 50 )
                                                    {{ substr($message->message,0,50).'...'; }}
                                                @else
                                                    {{ $message->message; }}
                                                @endif
                                            </td>
                                            <td class="text-right">
                                                <button class="btn btn-primary btn-sm btn-icon fetch-display-click" data="messageid:{{ $message->id }}|type:{{ $type }}|csrf-token:{{ csrf_token() }}" url="<?=url('Communication@read');?>" holder=".message-holder" modal="#read" loader="true"><i class=" mdi mdi-email-outline"></i>  {{sch_translate('read_messages')}}</button>
                                                <button class="btn btn-danger btn-sm send-to-server-click" data="messageid:{{ $message->id }}|type:{{ $type }}|csrf-token:{{ csrf_token() }}" url="{{ url('Communication@delete') }}" warning-title="{{sch_translate('are_you_sure')}}" warning-message="{{sch_translate('this_message_record_will_be_deleted')}}" warning-button="{{sch_translate('delete')}}" data-toggle="tooltip" data-placement="top" data-cancel-button="{{sch_translate('cancel')}}" title="{{sch_translate('delete')}}" data-original-title="{{sch_translate('Delete')}}" class="delete"><i class="mdi mdi-delete"></i></button>
                                            </td>
                                        </tr>
                                    @endforeach
                                @else
                                <tr><th colspan="7"><p class="text-muted text-center">{{sch_translate('empty_here')}}</p></th></tr>
                                @endif
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- footer -->
   @include("includes/footer")

    <!-- Send Email-->
    <div class="modal right fade" id="sendemail" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="mdi mdi-close-circle-outline"></i></span></button>
                    <h4 class="modal-title" id="myModalLabel2">{{sch_translate('send_email')}}</h4>
                </div>

                <div class="modal-body">
                    <form class="simcy-form translateValidation" data-parsley-validate="" action="{{ url('Communication@email') }}" method="POST" loader="true">
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <label for="email">{{sch_translate('recipient')}}</label>
                                <input type="hidden" value="{{ csrf_token() }}" name="csrf-token">
                                <select class="form-control select2" name="recipient">
                                    <option value="student">{{sch_translate('all_students')}}</option>
                                    <option value="staff">{{sch_translate('all_staffs')}}</option>
                                    <option value="instructor">{{sch_translate('all_instructors')}}</option>
                                    <option value="branches">{{sch_translate('all_branches')}}</option>
                                    @if( $user->role == "superadmin" )
                                    <option value="schools">{{sch_translate('all_schools')}}</option>
                                    @endif
                                    <option value="everyone">{{sch_translate('all_users')}}</option>
                                    @if(!empty($users))
                                    @foreach($users as $account)
                                        <option value="{{ $account->id }}">{{$account->fname}} {{$account->lname}} ( {{$account->role}} )</option>
                                    @endforeach
                                    @endif
                                </select>
                            </div>
                        </div>
                        </div>
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <label>{{sch_translate('subject')}}</label>
                                <input type="text" class="form-control" name="subject" placeholder="{{sch_translate('subject')}}" required="">
                            </div>
                        </div>
                        </div>
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <label>{{sch_translate('message')}}</label>
                                <textarea class="form-control" placeholder="{{sch_translate('message')}}" rows="6" name="message" required=""></textarea>
                            </div>
                        </div>
                        </div>
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <button class="btn btn-red btn-block" type="submit">{{sch_translate('send_email')}}</button>
                            </div>
                        </div>
                        </div>
                    </form>
                </div>
            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div>
    <!-- end Send Email-->

    <!-- Send SMS-->
    <div class="modal right fade" id="sendsms" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="mdi mdi-close-circle-outline"></i></span></button>
                    <h4 class="modal-title" id="myModalLabel2">{{sch_translate('send_sms')}}</h4>
                </div>

                <div class="modal-body">
                    <form class="simcy-form translateValidation" data-parsley-validate="" action="{{ url('Communication@sms') }}" method="POST" loader="true">
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <label for="email">{{sch_translate('recipient')}}</label>
                                <input type="hidden" value="{{ csrf_token() }}" name="csrf-token">
                                <select class="form-control select2" name="recipient">
                                    <option value="student">{{sch_translate('all_students')}}</option>
                                    <option value="staff">{{sch_translate('all_staffs')}}</option>
                                    <option value="instructor">{{sch_translate('all_instructors')}}</option>
                                    <option value="branches">{{sch_translate('all_branches')}}</option>
                                    @if( $user->role == "superadmin" )
                                    <option value="schools">{{sch_translate('all_schools')}}</option>
                                    @endif
                                    <option value="everyone">{{sch_translate('everyone')}}</option>
                                    @if(!empty($users))
                                    @foreach($users as $account)
                                        <option value="{{ $account->id }}">{{$account->fname}} {{$account->lname}} ( {{$account->role}} )</option>
                                    @endforeach
                                @endif
                                </select>
                            </div>
                        </div>
                        </div>
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <label>{{sch_translate('message')}}</label>
                                <textarea class="form-control" placeholder="{{sch_translate('message')}}" rows="6" name="message" required=""></textarea>
                            </div>
                        </div>
                        </div>
                        <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <button class="btn btn-red btn-block" type="submit">{{sch_translate('send_sms')}}</button>
                            </div>
                        </div>
                        </div>
                    </form>
                </div>

            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div>
    <!-- end SMS-->

    <!-- read -->
    <div class="modal right fade" id="read" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="mdi mdi-close-circle-outline"></i></span></button>
                    <h4 class="modal-title" id="myModalLabel2">{{sch_translate('read_messages')}}</h4>
                </div>
                <div class="message-holder"></div>
            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div>
    <!-- end read -->

    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.2/js/dataTables.buttons.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.4.2/js/buttons.flash.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
    <script src="//cdn.datatables.net/buttons/1.4.2/js/buttons.html5.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.4.2/js/buttons.print.min.js"></script>
    @if(!empty($messages))
    <script>
        $(document).ready(function() {
            $('#data-table').DataTable({
                dom: 'Bfrtip',
                "columnDefs": [ {
                    "targets"  : [4],
                    "orderable": false,
                }],
                "language": {
                    "lengthMenu": "Einträge _MENU_ anzeigen",
                    "zeroRecords": "Keine Daten vorhanden",
                    "info": "Eintrag _PAGE_ von _PAGES_ Einträgen",
                    "infoEmpty": "Keine Daten vorhanden",
                    "infoFiltered": "(filtered from _MAX_ total records)",
                    "paginate": {
                        "previous": "Zurück",
                        "next":"Weiter"
                    },
                    "search": "Suche _INPUT_",
                },
                buttons: [
                    'copyHtml5',
                    'excelHtml5',
                    {
                        extend: 'csv',
                        title: "{{sch_translate('communication')}}",
                        text: 'CSV',
                        charset: 'utf-8',
                        extension: '.csv',
                        fieldBoundary: '',
                        filename: "{{sch_translate('communication')}}",
                        bom: true
                    },
                ]
            });
        });
    </script>
    @endif
   <script src="{{ url('') }}assets/js/popper.min.js"></script>
   <script src="{{ url('') }}assets/libs/bootstrap/js/bootstrap.min.js"></script>
   <script src="{{ url('') }}assets/libs/jquery-slimscroll/jquery.slimscroll.min.js"></script>
   <script src="{{ url('') }}assets/js/simcify.min.js"></script>
   <script src="{{ url('') }}assets/js/app.js"></script>
   @include("translate/validation")
   @include("schleier/bottomscript")
</body>
</html>